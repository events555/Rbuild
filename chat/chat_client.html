<!-- CHAT HISTORY -->
<div id="chatShow"></div>

<!-- CHAT FORM -->
<form id="chatForm" onsubmit="return chat.send ();">
 <input id="chatMsg" type="text" required disabled>
 <input id="chatGo" type="submit" value="Go" disabled>
</form>

<!-- CHAT SCRIPT -->
<script src="http://localhost:5050/socket.io/socket.io.js"></script>
<script>
var chat = {
 // PROPERTIES
 socket : null,
 show : document.getElementById("chatShow"),
 form : document.getElementById("chatForm"),
 msg : document.getElementById("chatMsg"),
 go : document.getElementById("chatGo"),

 // CONNECT TO SOCKET.IO SERVER WITH A CHAT INSTANCE ID 
 init : function () {
   var chatId = prompt("Enter a chat ID"); // get a unique identifier for this chat instance
   
   if(chatId){
     this.socket = io.connect("/"+chatId,{query:"chatId="+chatId}); // connect to the server with this chat ID

     // WHEN CONNECTED - ENABLE CHAT FORM & SHOW WELCOME MESSAGE
     this.socket.on('connect', function () {
       chat.go.disabled = false;
       chat.msg.disabled = false;
       chat.show.innerHTML += "<p><i>Connected</i></p>";
     });

     // WHEN MESSAGE RECEIVED - APPEND TO CHAT HISTORY & SCROLL DOWN
     this.socket.on('message', function(msg){
       var received_msg = msg;
       chat.show.innerHTML += "<p>" + received_msg + "</p>";
       chat.show.scrollTop = chat.show.scrollHeight;
     });

     // WHEN ERROR - SHOW ERROR MESSAGE & DISABLE CHAT FORM
     this.socket.on('error', function(){
       chat.show.innerHTML += "<p><i>Error</i></p>";
       chat.go.disabled = true;
       chat.msg.disabled = true;
     });

     // WHEN CLOSED - SHOW DISCONNECTED MESSAGE & DISABLE CHAT FORM
     this.socket.on('disconnect', function(){
       chat.show.innerHTML += "<p><i>Disconnected</i></p>";
       chat.go.disabled = true;
       chat.msg.disabled = true;
     });
   }
 },

 // SEND MESSAGE TO SERVER 
 send : function () {
   var message= this.msg.value.trim();
   
   if(message != ""){
      this.socket.emit('message', message); // emit message to the server
      this.msg.value="";
      return false; 
    }
 }
};
window.addEventListener("load", function(){ 
    chat.init(); 
});
</script>

<!-- OPTIONAL CSS STYLING -->
<style>
#chatShow { height:300px; overflow-y:auto; border:1px solid black; }
#chatMsg { width:80%; }
#chatGo { width:15%; }
</style>
